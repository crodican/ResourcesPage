<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to right, #FF69B4, #8A2BE2); /* Pink to Purple Gradient */
            color: #333;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 20px; /* This makes the outer white container rounded */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        h1 {
            color: #55298a;
            margin-bottom: 10px;
            font-size: 2em;
        }

        h2 {
            color: #666;
            margin-bottom: 25px;
            font-size: 1.1em;
            font-weight: normal;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #55298a;
        }

        .input-group input[type="text"] {
            width: calc(100% - 20px);
            padding: 12px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        button {
            background-color: #8A2BE2; /* Purple */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
            margin: 5px;
        }

        button:hover {
            background-color: #6A1EB2; /* Darker Purple */
        }

        #qrcode {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 256px;
        }

        /* CSS for the QR Code SVG itself to have rounded corners */
        #qrcode svg {
            border-radius: 20px;
            /* overflow: hidden; */
        }

        .download-buttons {
            margin-top: 20px;
            display: none;
            justify-content: center;
            gap: 10px;
        }

        /* Hidden image for pre-rendering SVG */
        #hiddenLogoImage {
            position: absolute;
            left: -9999px; /* Off-screen */
            top: -9999px;
            opacity: 0;
            pointer-events: none;
            width: 200px; /* Set a reasonable size for rendering */
            height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Generator</h1>
        <h2>Enter your text or URL to generate a custom QR code</h2>

        <div class="input-group">
            <label for="qrText">Enter URL:</label>
            <input type="text" id="qrText" placeholder="e.g., https://www.example.com">
        </div>

        <button onclick="generateQRCode()">Generate QR Code</button>

        <div id="qrcode"></div>

        <div class="download-buttons" id="downloadButtons">
            <button onclick="downloadPng()">Download as PNG</button>
            <button onclick="downloadSvg()">Download as SVG</button>
        </div>
    </div>

    <img id="hiddenLogoImage" crossorigin="anonymous">

    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
    <script>
        let qrCode = null;
        let logoPngDataUri = null; // Will store the converted PNG data URI
        
        // Original SVG data
        const svgData = `<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 658 367">  <g transform="matrix(3.7944031 0 0 3.8927366 -36.16 2.912)">    <ellipse cx="96.869" cy="45.185" rx="57.334" ry="28.723" style="opacity:1;fill:#55298a;fill-opacity:1;stroke:#fff;stroke-width:5;stroke-linejoin:bevel;stroke-miterlimit:34.5;stroke-dasharray:none;stroke-opacity:1;paint-order:fill markers stroke"/>    <ellipse cx="96.869" cy="45.184" fill="none" rx="58.796" ry="30.185" style="opacity:1;fill:#552;fill-opacity:0;stroke:#55298a;stroke-width:2.07624;stroke-linejoin:bevel;stroke-miterlimit:34.5;stroke-dasharray:none;stroke-opacity:1;paint-order:fill markers stroke"/>  </g>  <path fill="#f7f6fa" d="M137.428 44.968c-.097 1.955-.228 3.79-.266 5.626-.016.774.25 1.555.231 2.329-.019.794-.25 1.724-1.243 1.672-.886-.047-1.452-.666-1.383-1.713.283-4.246.54-8.494.787-12.742.046-.783.007-1.57.007-2.327-1.53.068-2.962.155-4.395.185-.56.011-1.171.01-1.668-.201-.389-.165-.637-.662-.948-1.01.419-.368.82-1.033 1.258-1.057 4.52-.257 9.044-.422 13.568-.573.41-.013.969.128 1.21.41.353.411.48 1.015.703 1.537-.55.117-1.102.338-1.651.332a65.388 65.388 0 0 1-4.31-.22c-.89-.07-1.073.329-1.142 1.151-.182 2.166-.494 4.321-.758 6.6z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/>  <path fill="#f8f7fa" d="M116.788 47.278c.388 1.47-.135 3.067 1.027 4.197.541.526 1.137 1.097 1.819 1.358 2.112.807 4.662-.11 5.965-2.006.622-.905 1.432-.812 2.166-.26.75.566.789 1.192.038 1.953-2.284 2.316-5.074 3.153-8.219 2.931-2.345-.165-4.491-2.924-4.947-5.717-.71-4.345.534-8.235 2.81-11.739.986-1.52 2.744-2.713 4.4-3.58 2.002-1.045 4.563.703 5.485 3.419.18.53.35 1.116.3 1.656-.044.49-.279 1.214-.635 1.371-.652.288-1.301.073-1.656-.775a18.022 18.022 0 0 0-1.57-2.909c-.42-.64-1.023-.647-1.696-.17-2.901 2.054-4.522 4.863-5.047 8.343-.091.602-.16 1.207-.24 1.928zM102.785 45.933c1.194-3.298 2.376-6.492 3.532-9.696.128-.354.186-.771.141-1.143-.108-.886.244-1.592 1.076-1.617.553-.017 1.302.424 1.645.893.466.637.726 1.475.9 2.265.492 2.243.896 4.505 1.363 6.903.091.034.363.145.641.235 1.188.385 1.471 1.211.495 1.933-.99.732-.803 1.528-.708 2.495a87.29 87.29 0 0 1 .416 6.688c.008.366-.772 1.116-.962 1.049-.52-.184-1.208-.648-1.306-1.111-.206-.972-.045-2.017-.093-3.029-.068-1.442-.154-2.885-.32-4.318-.028-.237-.53-.619-.776-.592-.722.08-1.424.336-2.137.513-1.65.41-2.88 1.235-3.3 3.026-.424 1.802-.93 3.585-1.444 5.365-.104.36-.452.964-.596.939-.45-.08-1.076-.312-1.229-.661-.214-.49-.186-1.17-.047-1.714.361-1.411.84-2.792 1.191-3.927-.686-.42-1.505-.664-1.545-1-.068-.578.186-1.383.602-1.784.69-.666 1.615-1.087 2.46-1.712m3.575-1.02 2.818-.915-1.096-5.666c-1.017 2.088-1.72 4.202-2.394 6.326-.014.042.301.188.672.255z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/>  <path fill="#f6f4f9" d="M99.03 46.29c.088 1.142-.454 1.474-1.42 1.532-1.387.083-2.764.302-4.148.435-.776.075-1.597.24-1.993-.758-.49-1.234-.025-1.795 1.29-1.822 1.442-.03 2.89-.194 4.313-.438.954-.163 1.645-.092 1.957 1.05z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/>  <path fill="#f9f7fa" d="M88.397 49.022c-1.423 1.721-2.557 3.667-4.215 4.923-2.292 1.737-5.94 1.708-7.056-1.91-1.415-4.594-.238-8.75 2.426-12.574.67-.962 1.484-1.825 2.223-2.74.936-1.159 2.256-1.692 3.634-1.77.618-.036 1.47.565 1.892 1.122 3.052 4.025 3.65 8.32 1.096 12.95m-3.972-11.008c-2.872 2.175-3.835 5.163-3.322 8.577.238 1.58-.239 1.923-1.612 1.728-.065-.009-.144.075-.272.146 0 .714-.075 1.464.015 2.194.226 1.821 1.283 2.477 2.91 1.61 1.142-.608 2.309-1.428 3.072-2.448 2.473-3.301 3.354-7.403.998-11.074-.378-.588-.697-1.278-1.79-.733z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/>  <path fill="#f6f4f9" d="M64.798 36.458c1.185-2.036 3.538-3.044 6.036-2.64 1.916.311 3.977 2.187 4.013 4.246.023 1.279-.746 2.612-1.322 3.845-.321.686-.956 1.234-1.486 1.81-.529.576-1.103 1.11-1.715 1.72 2.666 2.576 4.165 5.81 5.681 9.023.235.498 1.203 1.135.1 1.716-.845.446-1.703-.067-2.176-1.051-.65-1.356-1.33-2.706-2.112-3.988-1.22-1.997-2.79-3.676-5.044-4.906-.268 2.26-.548 4.463-.778 6.672-.067.643-.018 1.22-.931 1.27-.974.051-1.418-.476-1.435-1.295-.021-.95.187-1.904.25-2.859.29-4.493.565-8.988.919-13.563m6.099 5.244c.372-.63.94-1.222 1.07-1.899.176-.915.364-2.125-.078-2.794-.67-1.01-2.03-1.148-3.218-.747-1.08.364-1.435 1.28-1.416 2.389.028 1.565.007 3.13.007 4.965.268-.012.839.124 1.207-.089.816-.47 1.53-1.118 2.428-1.825z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/>  <path fill="#f8f6fa" d="M50.67 42.49c-.294-1.824-.509-3.545-.911-5.221-.27-1.124.172-1.688 1.05-2.217 2.537-1.53 5.128-1.116 7.632-.091 1.149.47 2.216 1.323 3.1 2.22 2.154 2.182 1.475 3.741-.57 5.808-1.816 1.835-4.251 2.42-6.677 2.96-.413.092-.821.212-1.021.264 0 2.633-.02 5.136.012 7.638.01.712-.034 1.492-.852 1.435-.517-.035-1.324-.64-1.416-1.105-.249-1.263-.265-2.589-.226-3.885.047-1.589.593-3.203-.516-4.674-.126-.167.015-.547.055-.824.107-.73.226-1.458.34-2.308m2.595 1.237c2.468-.21 4.595-1.116 6.243-3.026.89-1.033 1.072-2.049.356-2.58-1.739-1.289-3.722-1.844-5.87-1.671-.763.061-1.361.377-1.249 1.429.203 1.893.256 3.802.52 5.848z" style="stroke-width:.264583" transform="matrix(3.7825542 0 0 3.8689138 -35.014 3.98)"/></svg>`;
        
        // This function converts the SVG string to a PNG data URI
        function convertSvgToPngDataUri(svgString, callback) {
            const img = document.getElementById('hiddenLogoImage');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Encode the SVG string for data URI
            const svgDataUri = 'data:image/svg+xml;base64,' + btoa(svgString);

            img.onload = () => {
                // Set canvas dimensions to match the rendered image
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                
                ctx.drawImage(img, 0, 0);
                logoPngDataUri = canvas.toDataURL('image/png');
                callback(); // Call the callback when conversion is complete
            };
            img.onerror = (e) => {
                console.error("Error loading SVG image for conversion:", e);
                // Fallback: If SVG fails to load/render, proceed without logo
                logoPngDataUri = null; 
                callback(); 
            };

            img.src = svgDataUri;
        }

        function generateQRCode() {
            const qrText = document.getElementById('qrText').value;
            const qrcodeDiv = document.getElementById('qrcode');
            const downloadButtonsDiv = document.getElementById('downloadButtons');

            qrcodeDiv.innerHTML = ''; // Clear any existing content
            downloadButtonsDiv.style.display = 'none';

            if (!qrText) {
                alert('Please enter text or a URL to generate a QR code.');
                return;
            }

            // If logo PNG is not ready, convert it first, then generate QR
            if (!logoPngDataUri) {
                console.log("Converting SVG to PNG for logo...");
                convertSvgToPngDataUri(svgData, () => {
                    // Once converted, call generateQRCode again
                    _createOrUpdateQRCode(qrText, qrcodeDiv, downloadButtonsDiv);
                });
            } else {
                // If logo PNG is already ready, just generate QR
                _createOrUpdateQRCode(qrText, qrcodeDiv, downloadButtonsDiv);
            }
        }

        // Helper function to create or update QR code, now always using PNG data
        function _createOrUpdateQRCode(qrText, qrcodeDiv, downloadButtonsDiv) {
            const currentImage = logoPngDataUri || undefined; // Use undefined if no logo

            if (!qrCode) {
                qrCode = new QRCodeStyling({
                    width: 256,
                    height: 256,
                    type: "svg",
                    data: qrText,
                    image: currentImage, // Use the converted PNG logo
                    dotsOptions: {
                        color: "#FFFFFF",
                        type: "extra-rounded"
                    },
                    backgroundOptions: {
                        color: "#55298a",
                    },
                    qrOptions: {
                        errorCorrectionLevel: 'H'
                    },
                    imageOptions: {
                        crossOrigin: "anonymous", 
                        margin: 5, 
                        imageSize: 0.4 
                    }
                });
                qrCode.append(qrcodeDiv);
            } else {
                qrCode.update({
                    data: qrText,
                    image: currentImage, // Update with the converted PNG logo
                    qrOptions: {
                        errorCorrectionLevel: 'H'
                    },
                    dotsOptions: {
                        type: "extra-rounded"
                    },
                    imageOptions: {
                        margin: 5,
                        imageSize: 0.4
                    }
                });
            }
            downloadButtonsDiv.style.display = 'flex';
        }


        function downloadPng() {
            if (qrCode) {
                qrCode.download({ name: "qrcode", extension: "png" });
            } else {
                alert("Please generate a QR code first!");
            }
        }

        function downloadSvg() {
            if (qrCode) {
                qrCode.download({ name: "qrcode", extension: "svg" });
            } else {
                alert("Please generate a QR code first!");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const qrTextInput = document.getElementById('qrText');
            qrTextInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter' || event.keyCode === 13) {
                    event.preventDefault();
                    generateQRCode();
                }
            });

            // Pre-convert logo on page load to be ready
            convertSvgToPngDataUri(svgData, () => {
                console.log("Logo pre-conversion complete.");
            });
        });
    </script>
</body>
</html>