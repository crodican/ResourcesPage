<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Recovery Support Locations</title>
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { width: 100%; height: 500px; }
        .location-links { margin-top: 20px; }
        .location-links button { padding: 8px 15px; margin-right: 10px; cursor: pointer; }
        .map-popup { padding: 10px; }
        .map-popup h3 { margin-top: 0; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="location-links">
    <h3>View Location Details:</h3>
    <button onclick="flyToLocationAndOpenPopup(0)">Berks County</button>
    <button onclick="flyToLocationAndOpenPopup(1)">Bucks County</button>
    <button onclick="flyToLocationAndOpenPopup(2)">Chester County</button>
    <button onclick="flyToLocationAndOpenPopup(3)">Delaware County</button>
    <button onclick="flyToLocationAndOpenPopup(4)">Lancaster County</button>
</div>

<script>
    const map = new maplibregl.Map({
        style: 'https://tiles.openfreemap.org/styles/liberty',
        center: [-75.347468, 40.104172],
        zoom: 9.5,
        container: 'map'
    });

    const locationsData = [
        {
            name: 'Berks County Council on Chemical Abuse',
            longitude: -75.9269,
            latitude: 40.3356,
            phone: '610-376-8669',
            address: '601 Penn Street, Suite 60 Reading, PA 19601',
            website: 'https://cocaberks.org/'
        },
        {
            name: 'Bucks County Drug & Alcohol Commission',
            longitude: -75.1299,
            latitude: 40.3101,
            phone: '215-444-2700',
            address: '55 East Court Street, 4th Floor Doylestown, PA 18901',
            website: 'https://www.bcdac.org/'
        },
        {
            name: 'Chester County Department of Drug and Alcohol Services',
            longitude: -75.6055,
            latitude: 39.9607,
            phone: '610-344-6620',
            address: '601 Westtown Road, Suite 325 West Chester, PA 19382',
            website: 'https://www.chesco.org/216/Drug-and-Alcohol'
        },
        {
            name: 'Delaware County Office of Behavioral Health',
            longitude: -75.2591,
            latitude: 39.9576,
            phone: '610-713-2365',
            address: '20 South 69th Street Upper Darby, PA 19082',
            website: 'https://delcohsa.org/mentalhealth.html'
        },
        {
            name: 'Lancaster County Drug & Alcohol Commission',
            longitude: -76.3062,
            latitude: 40.0417,
            phone: '717-299-8023',
            address: '150 North Queen Street, Suite 111 Lancaster, PA 17603',
            website: 'https://co.lancaster.pa.us/140/Drug-Alcohol-Commission'
        }
    ];

    const markers = []; // Array to store marker objects

    locationsData.forEach((location, index) => {
        // Create the popup content for each location
        const popupContent = `
            <div class="map-popup">
                <h3>${location.name}</h3>
                <p><strong>Phone:</strong> <a href="tel:${location.phone}">${location.phone}</a></p>
                <p><strong>Address:</strong> ${location.address}</p>
                <p><a href="${location.website}" target="_blank">Website</a></p>
            </div>
        `;

        // Create a new popup
        const popup = new maplibregl.Popup({ offset: 25 })
            .setHTML(popupContent);

        // Create a new marker
        const marker = new maplibregl.Marker()
            .setLngLat([location.longitude, location.latitude])
            .setPopup(popup) // Assign the popup to the marker
            .addTo(map);

        // Store the marker and its index for later use with the links
        markers.push({ marker: marker, index: index });
    });

    function flyToLocationAndOpenPopup(locationIndex) {
        const location = locationsData[locationIndex];
        map.flyTo({
            center: [location.longitude, location.latitude],
            zoom: 12,
            essential: true
        });

        // Open the popup for the corresponding marker
        markers.forEach(item => {
            if (item.index === locationIndex) {
                item.marker.togglePopup(); // Toggle to open if closed, close if open
            } else {
                item.marker.getPopup().remove(); // Ensure other popups are closed
            }
        });
    }

    // Add event listener to each marker to close other popups when one is opened
    markers.forEach(item => {
        item.marker.on('click', () => {
            markers.forEach(otherItem => {
                if (otherItem !== item) {
                    otherItem.marker.getPopup().remove();
                }
            });
        });
    });
</script>

</body>
</html>