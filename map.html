<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pennsylvania Recovery Hubs Map</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      padding: 2rem;
      background-color: #f8f9fa;
    }
    svg {
      width: 100%;
      max-width: 900px;
      height: auto;
      border: 1px solid #ccc;
      background: white;
    }
    svg path:hover {
      fill: #0714ff !important;
      cursor: pointer;
    }
    #popup {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
      padding: 1rem;
      min-width: 250px;
      z-index: 1000;
      display: none;
    }
    #popup-close {
      position: absolute;
      top: 0.25rem;
      right: 0.5rem;
      border: none;
      background: transparent;
      font-size: 1.2rem;
      line-height: 1;
      color: #666;
      cursor: pointer;
    }
.legend-circle {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 0.5rem;
}
  </style>
</head>
<body>

  <h1 class="mb-4">Click a County</h1>

  <!-- Popup Info Panel -->
  <div id="popup">
    <button id="popup-close">&times;</button>
    <div id="popup-content"></div>
  </div>

  <!-- Map Container -->
  <div id="map-container"></div>
<div class="mt-4" id="region-legend">
  <h5>Recovery Hub Regions</h5>
  <div class="d-flex flex-wrap gap-3 mt-2">
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #55298a;"></span> Region 1
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #414bb2;"></span> Region 2
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #625cff;"></span> Region 3
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #00c68f;"></span> Region 4
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #414bb2;"></span> Region 5
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #f37033;"></span> Region 6
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #c6cedc;"></span> Region 7
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #12cdd4;"></span> Region 8
    </div>
    <div class="d-flex align-items-center">
      <span class="legend-circle" style="background-color: #9298de;"></span> Region 9
    </div>
  </div>
</div>

  <!-- JS -->
  <script>
    const regionLookup = {
      "Philadelphia":       { region: 1, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
      "Allegheny":          { region: 2, org: "Unity Recovery", url: "https://unityrecovery.org/portfolios/recovery-hub" },
      "Erie":               { region: 3, org: "Erie County Office of Drug and Alcohol", url: "https://eriecountypa.gov/departments/human-services/drug-and-alcohol-abuse/" },
      "Berks": "R4", "Bucks": "R4", "Chester": "R4", "Delaware": "R4", "Lancaster": "R4", "Montgomery": "R4", "Schuylkill": "R4",
      "Adams": "R5", "Bedford": "R5", "Blair": "R5", "Cumberland": "R5", "Dauphin": "R5", "Franklin": "R5", "Fulton": "R5",
      "Huntingdon": "R5", "Juniata": "R5", "Lebanon": "R5", "Mifflin": "R5", "Perry": "R5", "York": "R5",
      "Armstrong": "R6", "Beaver": "R6", "Butler": "R6", "Cambria": "R6", "Fayette": "R6", "Greene": "R6",
      "Indiana": "R6", "Somerset": "R6", "Westmoreland": "R6", "Washington": "R6",
      "Cameron": "R7", "Clarion": "R7", "Clearfield": "R7", "Crawford": "R7", "Elk": "R7", "Forest": "R7",
      "Jefferson": "R7", "Lawrence": "R7", "Mckean": "R7", "Mercer": "R7", "Venango": "R7", "Warren": "R7",
      "Bradford": "R8", "Centre": "R8", "Clinton": "R8", "Columbia": "R8", "Lycoming": "R8", "Montour": "R8",
      "Northumberland": "R8", "Potter": "R8", "Snyder": "R8", "Sullivan": "R8", "Tioga": "R8", "Union": "R8",
      "Carbon": "R9", "Lackawanna": "R9", "Lehigh": "R9", "Luzerne": "R9", "Monroe": "R9", "Northampton": "R9",
      "Pike": "R9", "Susquehanna": "R9", "Wayne": "R9", "Wyoming": "R9"
    };

    const regionDetails = {
      R4: { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
      R5: { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
      R6: { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
      R7: { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
      R8: { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
      R9: { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" }
    };

    fetch('map.svg')
      .then(res => res.text())
      .then(svg => {
        document.getElementById('map-container').innerHTML = svg;

        const paths = document.querySelectorAll('#map-container svg path');
        paths.forEach(path => {
          const county = path.getAttribute('data-name') || path.getAttribute('id') || 'Unknown';
          path.addEventListener('click', (e) => {
            showPopup(county, e.pageX, e.pageY);
          });
        });
      });

    const popup = document.getElementById('popup');
    const popupContent = document.getElementById('popup-content');
    const closeBtn = document.getElementById('popup-close');

    closeBtn.addEventListener('click', () => popup.style.display = 'none');

function showPopup(rawCounty, x, y) {
  // Normalize county name
  const county = rawCounty
    .replace(/county/i, '')
    .trim()
    .toLowerCase()
    .replace(/\b\w/g, l => l.toUpperCase());

  let data = regionLookup[county];
  if (typeof data === 'string' && regionDetails[data]) {
    data = regionDetails[data];
  }

  let content = `<h5 class="text-uppercase">${county}</h5>`;
  if (data) {
    content += `
      <p><strong>Region:</strong> ${data.region}</p>
      <p><strong>Organization:</strong> ${data.org}</p>
      <p><a href="${data.url}" target="_blank">${data.url}</a></p>
    `;
  } else {
    content += `<p><em>No region data available.</em></p>`;
  }

  popupContent.innerHTML = content;

  // Get viewport dimensions
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  // Adjust popup direction based on click position
  const isRight = x > vw / 2;
  const isBottom = y > vh / 2;

  const offsetX = isRight ? -popup.offsetWidth - 10 : 10;
  const offsetY = isBottom ? -popup.offsetHeight - 10 : 10;

  popup.style.left = `${x + offsetX}px`;
  popup.style.top = `${y + offsetY}px`;
  popup.style.display = 'block';
}


    document.addEventListener('click', (e) => {
      if (!popup.contains(e.target) && !e.target.closest('path')) {
        popup.style.display = 'none';
      }
    });
  </script>

</body>
</html>
