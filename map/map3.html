<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pennsylvania Recovery Hubs Map</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://resourcespage.pages.dev/map.css"/>
</head>
<body id="main-body">
  <div class="row">
    <div class="col-12 col-md-8">
  <div id="main-map-container" class="map-container">
    <div id="map-svg" style="flex: 1 1 0;width: 100%;height:auto;border: 1px solid #ccc;background: white;display: block"></div>
  </div>
    </div>
    <div class="col-12 col-md-4">
    <div id="popup" style="width:100%;height:600px;z-index: 1000">
      <div id="popup-content"></div>
    </div>
    </div>
  </div>

  <script>
(function() {
  const activeScheme = "scheme-3";

  const colorSchemes = {
    "scheme-1": {
      1: "#55298a", 2: "#8B4513", 3: "#00BFFF", 4: "#34A853", 5: "#338DFF",
      6: "#FF8800", 7: "#B54DFF", 8: "#FF5733", 9: "#FFC300",
    },
    "scheme-2": {
      1: "#55298a", 2: "#A0522D", 3: "#20B2AA", 4: "#6B8E23", 5: "#6495ED",
      6: "#FF7F50", 7: "#8A2BE2", 8: "#CD5C5C", 9: "#DDAA00",
    },
    "scheme-3": {
      1: "#55298a", 2: "#8B0000", 3: "#40E0D0", 4: "#2E8B57", 5: "#4682B4",
      6: "#FF8C00", 7: "#9932CC", 8: "#DC143C", 9: "#FFD700",
    },
    "scheme-4": {
      1: "#55298a", 2: "#CFCFC4", 3: "#ACE1AF", 4: "#77DD77", 5: "#b6ebff",
      6: "#FFCC99", 7: "#B19CD9", 8: "#FFB347", 9: "#FDFD96",
    },
    "scheme-5": {
      1: "#55298a", 2: "#5F9EA0", 3: "#87CEEB", 4: "#66CDAA", 5: "#1E90FF",
      6: "#CD853F", 7: "#DA70D6", 8: "#FF6347", 9: "#F0E68C",
    }
  };

  const logoPaths = {
    1: "https://resourcespage.pages.dev/assets/resource-logos/councilsepa.svg",
    2: "https://resourcespage.pages.dev/assets/resource-logos/unity.svg",
    3: "https://resourcespage.pages.dev/assets/resource-logos/erie.png",
    4: "https://resourcespage.pages.dev/assets/resource-logos/councilsepa.svg",
    5: "https://resourcespage.pages.dev/assets/resource-logos/pmhca.svg",
    6: "https://resourcespage.pages.dev/assets/resource-logos/aicdac.png",
    7: "https://resourcespage.pages.dev/assets/resource-logos/aicdac.png",
    8: "https://resourcespage.pages.dev/assets/resource-logos/westbranch.svg",
    9: "https://resourcespage.pages.dev/assets/resource-logos/northbound.png"
  };

  const regionData = {
    "Philadelphia": { region: 1, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Allegheny": { region: 2, org: "Unity Recovery", url: "https://unityrecovery.org/portfolios/recovery-hub" },
    "Erie": { region: 3, org: "Erie County Office of Drug and Alcohol", url: "https://eriecountypa.gov/departments/human-services/drug-and-alcohol-abuse/" },
    "Berks": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Bucks": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Chester": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Delaware": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Lancaster": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Montgomery": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Schuylkill": { region: 4, org: "The Council of Southeast Pennsylvania", url: "https://councilsepa.org/hubs" },
    "Adams": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Bedford": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Blair": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Cumberland": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Dauphin": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Franklin": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Fulton": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Huntingdon": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Juniata": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Lebanon": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Mifflin": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Perry": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "York": { region: 5, org: "Pennsylvania Mental Health Consumer's Association", url: "https://pmhca.wildapricot.org/Recovery-Hub" },
    "Armstrong": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Beaver": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Butler": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Cambria": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Fayette": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Greene": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Indiana": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Somerset": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Westmoreland": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Washington": { region: 6, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Cameron": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Clarion": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Clearfield": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Crawford": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Elk": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Forest": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Jefferson": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Lawrence": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Mckean": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Mercer": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Venango": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Warren": { region: 7, org: "A.I.C.D.A.C.", url: "https://aicdac.org/recovery-hub/" },
    "Bradford": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Centre": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Clinton": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Columbia": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Lycoming": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Montour": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Northumberland": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Potter": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Snyder": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Sullivan": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Tioga": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Union": { region: 8, org: "W Branch Drug and Alcohol Commission", url: "https://wbdrugandalcohol.org" },
    "Carbon": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Lackawanna": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Lehigh": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Luzerne": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Monroe": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Northampton": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Pike": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Susquehanna": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Wayne": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" },
    "Wyoming": { region: 9, org: "Northbound and Co", url: "https://northboundandco.org/" }
  };

  const regionColors = colorSchemes[activeScheme];
  const body = document.getElementById('main-body');
  const svgContainer = document.getElementById('map-svg');
  const popup = document.getElementById('popup');
  const popupContent = document.getElementById('popup-content');

  body.classList.add(activeScheme);

  function renderPopupCard(data, county) {
    let cardHtml = '';
    if (data) {
      const countyDisplayName = (county === "Philadelphia") ? "Philadelphia" : `${county} County`;
      const organizationLogo = logoPaths[data.region] || '';
      const badgeColor = regionColors[data.region] || '#0d6efd';

      cardHtml = `
        <div class="card shadow-sm bg-white" style="height:600px">
          <button id="popup-close" class="btn btn-sm btn-light position-absolute" style="top:0.25rem;right:0.5rem;z-index:2;">&times;</button>
          <div class="card-body pb-0">
            <span class="badge rounded-pill mb-2" style="background-color: ${badgeColor}; color: white;">Region ${data.region}</span>
            <h5 class="card-title text-capitalize">${countyDisplayName}</h5>
            <h6 class="card-subtitle mb-2 text-muted">${data.org}</h6>
            <a href="${data.url}" target="_blank" class="card-link">Website</a>
          </div>
          ${
            organizationLogo
              ? `<div class="card-img-bottom p-2">
                  <img src="${organizationLogo}" alt="${data.org} Logo" class="organization-logo" style="width:100%">
                 </div>`
              : ''
          }
        </div>
      `;
    } else {
      cardHtml = `
        <div class="card shadow-sm">
          <button id="popup-close" class="btn btn-sm btn-light position-absolute" style="top:0.25rem;right:0.5rem;z-index:2;">&times;</button>
          <div class="card-body">
            <h5 class="card-title text-capitalize">${county} County</h5>
            <p><em>No region data available.</em></p>
          </div>
        </div>
      `;
    }
    popupContent.innerHTML = cardHtml;
  }

  function showPopup(county, x, y) {
    const data = regionData[county];
    renderPopupCard(data, county);

    const dynamicCloseBtn = popupContent.querySelector('#popup-close');
    if (dynamicCloseBtn) dynamicCloseBtn.onclick = () => popup.style.display = 'none';

    popup.style.display = 'block';

    const popupRect = popup.getBoundingClientRect();
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    const padding = 10;
    let left = x + padding;
    let top = y + padding;

    if (x > vw / 2) {
      left = x - popupRect.width - padding;
    }
    if (y > vh / 2) {
      top = y - popupRect.height - padding;
    }
    
    left = Math.max(padding, Math.min(left, vw - popupRect.width - padding));
    top = Math.max(padding, Math.min(top, vh - popupRect.height - padding));

    popup.style.left = `${left}px`;
    popup.style.top = `${top}px`;
  }

  fetch('https://resourcespage.pages.dev/map.svg')
    .then(res => res.text())
    .then(svg => {
      svgContainer.innerHTML = svg;
      const svgEl = svgContainer.querySelector('svg');
      if (svgEl) svgEl.classList.add(activeScheme);

      const paths = svgContainer.querySelectorAll('svg path');
      paths.forEach(path => {
        const county = path.getAttribute('data-name') || path.getAttribute('id') || 'Unknown';
        const data = regionData[county];
        if (data && data.region) {
          path.classList.add(`region${data.region}`);
          path.style.fill = regionColors[data.region];
        }
      });
    });

  svgContainer.addEventListener('click', (e) => {
    const path = e.target.closest('path');
    if (path) {
      const county = path.getAttribute('data-name') || path.getAttribute('id');
      if (county) {
        showPopup(county, e.pageX, e.pageY);
      }
    } else {
      popup.style.display = 'none';
    }
  });

  document.addEventListener('click', (e) => {
    const isClickInsidePopup = popup.contains(e.target);
    const isClickOnPath = e.target.closest('path');
    if (!isClickInsidePopup && !isClickOnPath) {
      popup.style.display = 'none';
    }
  });

})();
  </script>
</body>
</html>