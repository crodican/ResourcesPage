<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Resource Directory</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,600;1,600&amp;display=swap"
        rel="stylesheet" /> 
    <link href="https://fonts.googleapis.com/css2?family=Oxygen:wght@300;400;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet" />
    <!-- Elevation Bootstrap CSS -->
    <link rel="stylesheet" href="https://resourcespage.pages.dev/elevation-bootstrap.css" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Bootstrap 5.3.3 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
    <!-- Custom Colors CSS -->
    <link rel="stylesheet" href="https://resourcespage.pages.dev/customColors.css" />
    <style>
        .card-sidenav {
            max-width: 70px;
            border-radius: 5px 0 0 5px;
        }

        .card-sidenav a {
            background-color: #55298a;
            color: white !important;
            font-size: 36px;
        }

        .card-sidenav a:hover {
            background-color: #f5ebf3;
            color: #55298a !important;
            overflow: hidden;
        }

        .card-sidenav a:nth-of-type(1) {
            border-radius: 5px 0 0 0;
        }

        .card-sidenav a:nth-of-type(2) {
            border-radius: 0;
        }

        .card-sidenav a:nth-of-type(3) {
            border-radius: 0 0 0 5px;
        }

        .cardImage {
            max-width: 150px;
            height: auto !important;
            @media (width < 768px) {
                position: static;
            }
        }

        .chip {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            margin: 5px;
            background-color: #e0e0e0;
            border-radius: 20px;
        }

        .close-chip {
            margin-left: 5px;
            cursor: pointer;
        }

        .br-35-5-35-5 { border-radius: 35px 5px 35px 5px; }
        .br-35-5-5-5 { border-radius: 35px 5px 35px 5px; }
        .br-5-35-5-5 { border-radius: 5px 35px 5px 5px; }
        .br-5-5-35-5 { border-radius: 5px 5px 35px 5px; }
        .br-5-5-5-35 { border-radius: 5px 5px 5px 35px; }
        .br-35-35-5-5 { border-radius: 35px 35px 5px 5px; }
        .br-35-5-35-5 { border-radius: 35px 5px 35px 5px; }
        .br-35-5-5-35 { border-radius: 35px 5px 5px 5px; }
        .br-5-35-35-5 { border-radius: 5px 35px 35px 5px; }
        .br-5-5-35-35 { border-radius: 5px 5px 35px 35px; }
        .br-5-35-35-35 { border-radius: 5px 35px 35px 35px; }
        .br-35-5-35-35 { border-radius: 35px 5px 35px 35px; }
        .br-35-35-5-35 { border-radius: 35px 35px 5px 35px; }
        .br-35-35-35-5 { border-radius: 35px 35px 35px 5px; }
        .br-5-35-5-35 { border-radius: 5px 35px 5px 35px; }

        label {
            padding: 2px 8px;
        }
        
        label:active {
            background-color: rgba(89, 49, 150, 0.25);
            border-radius: 3px;
        }
        
        label:hover {
            background-color: rgba(89, 49, 150, 0.25);
            border-radius: 3px;
        }
        
        .resourceCard .breadcrumb {
            background-color: transparent;
        }
        
        .resourceCard .badge {
            margin-right: 15px;
        }
    </style>
</head>
<body class="bg-success-subtle">    <div class="container mt-5">
        <h1>Resource Directory</h1>
        <div class="row mb-4">
            <div class="bg-white br-35-5-35-5 shadow p-4">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <button class="btn customButton--secondary py-1 px-2" type="button"
                                            style="border-radius: 10px 1px 1px 10px !important" data-bs-toggle="modal"
                                            data-bs-target="#allCountiesModal">
                                            <span class="bi bi-geo-alt-fill"></span><span
                                                style="margin-left:15px">MAP</span>
                                        </button>
                                    </div>                
<input type="text" id="search-input"  class="form-control border-0 bg-gray-subtle py-0 px-4" placeholder="Search resources...">
                                    <div class="input-group-append kbd">
                                        <div class="bg-gray-subtle px-2 py-1 d-flex" style="height: 100%">
                                            <span><kbd>CTRL</kbd> + <kbd>K</kbd></span>
                                        </div>
                                    </div>
                                    <div class="input-group-append">
                                        <button class="btn customButton--secondary py-1 px-3 searchButton" type="button"
                                            style="border-radius: 1px 10px 10px 1px !important">
                                            <span class="bi bi-search"></span>
                                        </button>
                                    </div>
                                </div>

<div id="chip-container" class="mb-3"></div>
            </div>
        </div>

        <div class="row d-flex justify-content-between">
            <div class="col-md-3">
                <div id="filter-area" class="row d-flex justify-content-around">
                    <div class="mb-4 py-4 row bg-white rounded">
                        <h5>Counties</h5>
                        <div id="counties-filter" class="row row-cols-lg-1 row-cols-md-1 row-cols-sm-2 row-cols-2">
                        </div>
                    </div>
                    <div class="mb-4 py-4 row bg-white rounded">
                        <h5>Populations Served</h5>
                        <div id="populations-filter" class="row row-cols-lg-1 row-cols-md-1 row-cols-sm-2 row-cols-2 ">
                        </div>
                    </div>
                    <div class="mb-4 py-4 row bg-white rounded">
                        <h5>Service Areas</h5>
                        <div id="service-areas-filter" class="row row-cols-lg-1 row-cols-md-1 row-cols-sm-2 row-cols-2 ">
                        </div>
                    </div>
                    <div class="mb-4 py-4 row bg-white rounded">
                        <h5>Categories</h5>
                        <div id="categories-filter" class="row row-cols-lg-1 row-cols-md-1 row-cols-sm-2 row-cols-2 ">
                        </div>
                    </div>
                </div>
            </div>
<div class="col-md-9">
    <div id="controls-area" class="mb-3 d-flex align-items-center">
    </div>
    <div id="results-area" class="px-3">
    </div>
    <div id="pagination-controls" class="mt-3 d-flex justify-content-center">
    </div>
</div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src="taxonomyData.js"></script>
    <script src="resourcesData.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to display resources as Bootstrap cards
        function displayResources(resources, page = 1) {
            const resultsArea = document.getElementById('results-area');
            const paginationControls = document.getElementById('pagination-controls');
            resultsArea.innerHTML = ''; // Clear previous results
            paginationControls.innerHTML = '';

            const resourcesPerPage = 25;
            const startIndex = (page - 1) * resourcesPerPage;
            const endIndex = startIndex + resourcesPerPage;
            const pageResources = resources.slice(startIndex, endIndex);

            pageResources.forEach(resource => {
                const card = document.createElement('div');
                card.classList.add('col-12');
                card.innerHTML = `
                    <div class="card shadow-lg text-bg-white br-5-5-5-5 mb-5">
                        <div class="row no-gutters p-0">
                            <div class="card-sidenav col-2 d-flex flex-column justify-content-between align-items-center p-0">
                                <a href="${resource.Website}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white"> <i class="bi bi-globe"></i> </a>
                                <a href="${resource["Phone URL"]}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white"> <i class="bi bi-telephone-fill"></i> </a>
                                <a href="${resource["Google Maps URL"]}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white"> <i class="bi bi-geo-alt-fill"></i> </a>
                            </div>
                            <div class="card-body col-10 p-4">
                                <h3 class="text-secondary" style="font-weight:400;margin-bottom:0;line-height:1.2em;font-size:36px">${resource["Location Name"]}</h3>
                                <h5 style="font-weight:100;margin-top:0;font-size:18px">${resource.Organization}</h5>
                                <div class="row">
                                    <div class="col">
                                        <nav aria-label="breadcrumb">
                                            <ol class="breadcrumb">
                                                <li class="cardbreadcrumb-item">
                                                    ${resource["Service Area"].split('; ').map(area => `<span class="badge text-black bg-pink py-2 my-1"> ${area.trim()} </span>`).join('')}
                                                </li>
                                                <li class="cardbreadcrumb-item">
                                                    ${resource.Category.split('; ').map(cat => `<span class="badge text-black bg-pink py-2 my-1"> ${cat.trim()} </span>`).join('')}
                                                </li>
                                            </ol>
                                        </nav>
                                        <p><strong>Phone:</strong> ${resource.Phone}</p>
                                        <p>${resource.Address} <br />${resource.City}, ${resource.State} ${resource["Zip Code"]}</p>
                                    </div>
                                    <div class="col d-flex justify-content-end align-items-end"> <img class="cardImage" src="${resource.Image}" alt="Logo"> </div>
                                </div>
                                <p><strong>Populations Served:</strong> ${resource["Populations Served"].split('; ').map(pop => `<span class="badge text-black bg-pink py-2 my-1"> ${pop.trim()} </span>`).join('')}</p>
                                <p><strong>Counties Served:</strong> ${resource.County.split('; ').map(county => `<span class="badge text-black bg-pink py-2 my-1">${county.trim()}</span>`).join('')}</p>
                            </div>
                        </div>
                    </div>
                `;
                resultsArea.appendChild(card);
            });

            // Pagination controls
            const totalPages = Math.ceil(resources.length / resourcesPerPage);
            if (totalPages > 1) {
                paginationControls.appendChild(createPaginationButton('Previous', page > 1 ? page - 1 : 1, page === 1));
                for (let i = 1; i <= totalPages; i++) {
                    paginationControls.appendChild(createPaginationButton(i, i, i === page));
                }
                paginationControls.appendChild(createPaginationButton('Next', page < totalPages ? page + 1 : totalPages, page === totalPages));
            }
        }
        // Fuse.js options for search
        const options = {
            keys: ['Location Name', 'Organization', 'County', 'Service Area', 'Category', 'Populations Served', 'Address', 'City', 'State', 'Zip Code'],
            threshold: 0.3 // Adjust threshold as needed for fuzzy search accuracy
        };
        // Initialize Fuse.js with the loaded JSON data
        const fuse = new Fuse(jsonData, options);
        // Initial display of all resources
        displayResources(jsonData);
        // Get the search input element
        const searchInput = document.getElementById('search-input');
        // Get the chip container
        const chipContainer = document.getElementById('chip-container');
        // Get the filter area
        const filterArea = document.getElementById('filter-area');
        // Focus search input on Ctrl+K (or Cmd+K)
        document.addEventListener('keydown', function (event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault(); // Prevent browser's default behavior
                searchInput.focus();
            }
        });
        // Add event listener to the search input for live search
        searchInput.addEventListener('input', function () {
            const searchTerm = searchInput.value;
            filterResources();
            updateSearchChip(searchTerm);
        });
        // Function to populate filter checkboxes
        function populateFilters() {
            const counties = ['Philadelphia', 'Berks', 'Bucks', 'Chester', 'Delaware', 'Lancaster', 'Montgomery', 'Schuylkill'];
            const populations = ['Men', 'Women', 'Children', 'Adolescents'];
            const serviceAreas = ['Recovery Support', 'Family Support', 'Housing', 'Transportation'];
            const categories = ['Single County Authority', 'Center of Excellence', 'Regional Recovery Hub', 'Recovery Community Organization', 'Warm Handoff', 'Treatment with RSS', 'Counseling', 'Peer Support', 'Assistance Program', 'Recovery House', 'Halfway House', 'Housing Assistance', 'Other', 'Affordable Public Transportation', 'Carpool Service', 'Medical Assistance Transportation', 'Recovery Transportation Services', 'Vehicle Purchase Assistance', 'Other'];

            const countiesFilter = document.getElementById('counties-filter');
            counties.forEach(county => countiesFilter.appendChild(createCheckbox(county, 'county')));

            const populationsFilter = document.getElementById('populations-filter');
            populations.forEach(pop => populationsFilter.appendChild(createCheckbox(pop, 'population')));

            const serviceAreasFilter = document.getElementById('service-areas-filter');
            serviceAreas.forEach(area => serviceAreasFilter.appendChild(createCheckbox(area, 'serviceArea')));

            const categoriesFilter = document.getElementById('categories-filter');
            categories.forEach(cat => categoriesFilter.appendChild(createCheckbox(cat, 'category')));
        }
        // Function to create a checkbox element
        function createCheckbox(value, category) {
            const label = document.createElement('label');
            label.innerHTML = `<input type="checkbox" value="${value}" data-category="${category}"> ${value} `;
            return label;
        }
        // Populate the filter checkboxes
        populateFilters();
        // Function to filter resources based on checkbox selections
        function filterResources() {
            const selectedCounties = getSelectedFilters('county');
            const selectedPopulations = getSelectedFilters('population');
            const selectedServiceAreas = getSelectedFilters('serviceArea');
            const selectedCategories = getSelectedFilters('category');
            let filteredData = jsonData;
            if (selectedCounties.length > 0) {
                filteredData = filteredData.filter(item => selectedCounties.includes(item.County));
            }
            if (selectedPopulations.length > 0) {
                filteredData = filteredData.filter(item => item["Populations Served"].split('; ').some(pop => selectedPopulations.includes(pop)));
            }
            if (selectedServiceAreas.length > 0) {
                filteredData = filteredData.filter(item => item["Service Area"].split('; ').some(area => selectedServiceAreas.includes(area)));
            }
            if (selectedCategories.length > 0) {
                filteredData = filteredData.filter(item => item.Category.split('; ').some(cat => selectedCategories.includes(cat)));
            }
            const searchTerm = document.getElementById('search-input').value;
            let results;
            if (searchTerm) {
                results = fuse.search(searchTerm).map(result => result.item);
                results = results.filter(item => filteredData.includes(item));
            } else {
                results = filteredData;
            }

            // Sorting logic
            const sortBy = sortDropdown.value;
            if (sortBy) {
                results.sort((a, b) => {
                    let aVal, bVal;
                    if (sortBy === 'county') {
                        aVal = a.County;
                        bVal = b.County;
                    } else if (sortBy === 'populations') {
                        aVal = a["Populations Served"];
                        bVal = b["Populations Served"];
                    } else if (sortBy === 'serviceArea') {
                        aVal = a["Service Area"];
                        bVal = b["Service Area"];
                    }
                    return aVal.localeCompare(bVal);
                });
            } else {
              //if no sort is selected, return to original order.
              results = results.sort((a,b) => jsonData.indexOf(a) - jsonData.indexOf(b));
            }

            displayResources(results, currentPage);

            // Update resource count
            document.getElementById('resource-count').textContent = `Showing ${results.length} resources`;
        }
        // Function to get selected filter values
        function getSelectedFilters(category) {
            const checkboxes = document.querySelectorAll(`#filter-area input[data-category="${category}"]:checked`);
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }
        filterArea.addEventListener('change', function () {
            filterResources();
            updateFilterChips();
        });
        function updateSearchChip(searchTerm) {
            // Clear existing search chip
            const existingSearchChip = chipContainer.querySelector('.search-chip');
            if (existingSearchChip) {
                existingSearchChip.remove();
            }
            if (searchTerm) {
                const chip = createChip(searchTerm, 'search');
                chip.classList.add('search-chip');
                chipContainer.appendChild(chip);
            }
        }
        function updateFilterChips() {
            // Clear existing filter chips
            const filterChips = chipContainer.querySelectorAll('.filter-chip');
            filterChips.forEach(chip => chip.remove());
            // Add new filter chips
            const selectedCounties = getSelectedFilters('county');
            const selectedPopulations = getSelectedFilters('population');
            const selectedServiceAreas = getSelectedFilters('serviceArea');
            const selectedCategories = getSelectedFilters('category');
            selectedCounties.forEach(county => chipContainer.appendChild(createChip(county, 'county')));
            selectedPopulations.forEach(pop => chipContainer.appendChild(createChip(pop, 'population')));
            selectedServiceAreas.forEach(area => chipContainer.appendChild(createChip(area, 'serviceArea')));
            selectedCategories.forEach(cat => chipContainer.appendChild(createChip(cat, 'category')));
        }
        function createChip(text, category) {
            const chip = document.createElement('div');
            chip.classList.add('chip', 'filter-chip'); // Add your chip styling classes
            chip.textContent = text;
            chip.dataset.category = category;
            const closeButton = document.createElement('span');
            closeButton.innerHTML = "&times;";
            closeButton.classList.add('close-chip');
            chip.appendChild(closeButton);
            closeButton.addEventListener('click', function () {
                if (category === 'search') {
                    searchInput.value = '';
                } else {
                    const checkbox = document.querySelector(`#filter-area input[data-category="${category}"][value="${text}"]`);
                    if (checkbox) {
                        checkbox.checked = false;
                    }
                }
                filterResources();
                chip.remove();
            });
            return chip;
        }
        // Add event listener to the filter area for checkbox changes
        filterArea.addEventListener('change', filterResources);
// Get the controls area
        const controlsArea = document.getElementById('controls-area');

        // Add clear all filters button
        const clearFiltersButton = document.createElement('button');
        clearFiltersButton.textContent = 'Clear All Filters';
        clearFiltersButton.classList.add('btn', 'btn-secondary', 'me-2');
        clearFiltersButton.addEventListener('click', function () {
            searchInput.value = '';
            document.querySelectorAll('#filter-area input:checked').forEach(checkbox => checkbox.checked = false);
            sortDropdown.value = ""; // Reset sorting dropdown
            currentPage = 1; // Reset current page
            filterResources();
        });
        controlsArea.appendChild(clearFiltersButton);

        // Add sorting dropdown
        const sortDropdown = document.createElement('select');
        sortDropdown.classList.add('form-select', 'me-2');
        sortDropdown.innerHTML = `
            <option value="">Sort By</option>
            <option value="county">County</option>
            <option value="populations">Populations Served</option>
            <option value="serviceArea">Service Area</option>
        `;
        sortDropdown.addEventListener('change', function () {
            currentPage = 1; // Reset current page
            filterResources();
        });
        controlsArea.appendChild(sortDropdown);

        // Create the resource count element outside filterResources
        const countElement = document.createElement('div');
        countElement.id = 'resource-count';
        countElement.classList.add('ms-2');
        controlsArea.appendChild(countElement);

        // Function to create pagination buttons
        function createPaginationButton(text, page, isDisabled) {
            const button = document.createElement('button');
            button.textContent = text;
            button.classList.add('btn', 'btn-outline-secondary', 'mx-1');
            button.disabled = isDisabled;
            button.addEventListener('click', () => {
                currentPage = page;
                filterResources();
            });
            return button;
        }

        let currentPage = 1;
        const resourcesPerPage = 25;

        // Initial resource count and display
        filterResources();
    });
</script>
</body>
</html>