<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Oxygen:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Oxygen', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lora', serif;
        }
        .card-sidenav {
            max-width: 70px;
            border-radius: 5px 0 0 5px;
        }
        .card-sidenav a {
            background-color: #55298a;
            color: white !important;
            font-size: 36px;
        }
        .card-sidenav a:hover {
            background-color: #f5ebf3;
            color: #55298a !important;
            overflow: hidden;
        }
        .card-sidenav a:nth-of-type(1) {
            border-radius: 5px 0 0 0;
        }
        .card-sidenav a:nth-of-type(2) {
            border-radius: 0;
        }
        .card-sidenav a:nth-of-type(3) {
            border-radius: 0 0 0 5px;
        }
        .cardImage {
            max-width: 150px;
            height: auto !important;
        }
        @media (width < 768px) {
            .cardImage {
                position: static;
            }
        }
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            margin: 5px;
            background-color: #f5ebf3;
            border-radius: 20px;
            color: #000;
        }
        .close-chip {
            margin-left: 5px;
            cursor: pointer;
        }
        label {
            padding: 2px 8px;
        }
        label:active {
            background-color: rgba(89, 49, 150, 0.25);
            border-radius: 3px;
        }
        label:hover {
            background-color: rgba(89, 49, 150, 0.25);
            border-radius: 3px;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .results-count {
            font-size: 1rem;
            color: #666;
        }
        .sort-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sort-control label {
            font-size: 0.9rem;
            font-weight: 400;
            color: #555;
            margin-bottom: 0;
        }
        .sort-control select {
            border-radius: 5px;
            padding: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid #ddd;
        }
        .sort-control select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        #load-more {
            margin-top: 20px;
            text-align: center;
        }
        #load-more button {
            border-radius: 5px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }
        .badge-filter {
            background-color: #f5ebf3;
            color: #000;
            cursor: pointer;
        }
        .badge-filter:hover {
            background-color: #e0d0e0;
        }
        .filter-section {
            margin-bottom: 20px;
        }
        .filter-toggle {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .filter-toggle i {
            transition: transform 0.3s ease;
        }
        .filter-toggle.collapsed i {
            transform: rotate(-90deg);
        }
        .form-check-input:checked {
            background-color: #55298a;
            border-color: #55298a;
        }
        .form-check-label {
            cursor: pointer;
        }
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        .chips-container {
            min-height: 40px;
            margin-bottom: 20px;
        }
        .bg-gray-subtle {
            background-color: #f8f9fa;
        }
        .customButton--secondary {
            background-color: #55298a;
            color: white;
        }
        .customButton--secondary:hover {
            background-color: #3a1c5f;
            color: white;
        }
        .resourceCard {
            border-radius: 5px;
            margin-bottom: 25px;
        }
        .text-secondary {
            color: #55298a !important;
        }
        .badge.bg-pink {
            background-color: #f5ebf3;
            color: #000;
        }
    </style>
</head>
<body class="container py-4">
    <h1 class="text-center mb-4">Resource Directory</h1>
    
    <!-- Search Bar -->
    <div class="search-container mb-4">
        <div class="input-group">
            <input type="text" id="search-input" class="form-control border-0 bg-gray-subtle py-2 px-4" placeholder="Click Here or CTRL + K to Search">
            <div class="input-group-append kbd">
                <div class="bg-gray-subtle px-2 py-1 d-flex" style="height: 100%">
                    <span><kbd>CTRL</kbd> + <kbd>K</kbd></span>
                </div>
            </div>
            <div class="input-group-append">
                <button class="btn customButton--secondary py-1 px-3 searchButton" type="button" style="border-radius: 1px 10px 10px 1px !important">
                    <span class="bi bi-search"></span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Chips Area -->
    <div id="chips-container" class="chips-container"></div>
    
    <!-- Filters Section -->
    <div class="filter-section">
        <h2 class="filter-toggle" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="true">
            Filters
            <i class="bi bi-chevron-down"></i>
        </h2>
        <div class="collapse show" id="filtersCollapse">
            <div class="row mt-3">
                <!-- Counties Filter -->
                <div class="col-lg-3 col-md-3 col-sm-10 mb-4">
                    <h5>Counties</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Philadelphia" id="county-philadelphia">
                        <label class="form-check-label" for="county-philadelphia">Philadelphia</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Berks" id="county-berks">
                        <label class="form-check-label" for="county-berks">Berks</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Bucks" id="county-bucks">
                        <label class="form-check-label" for="county-bucks">Bucks</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chester" id="county-chester">
                        <label class="form-check-label" for="county-chester">Chester</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Delaware" id="county-delaware">
                        <label class="form-check-label" for="county-delaware">Delaware</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lancaster" id="county-lancaster">
                        <label class="form-check-label" for="county-lancaster">Lancaster</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Montgomery" id="county-montgomery">
                        <label class="form-check-label" for="county-montgomery">Montgomery</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Schuylkill" id="county-schuylkill">
                        <label class="form-check-label" for="county-schuylkill">Schuylkill</label>
                    </div>
                </div>
                
                <!-- Populations Filter -->
                <div class="col-lg-3 col-md-3 col-sm-10 mb-4">
                    <h5>Populations</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Men" id="population-men">
                        <label class="form-check-label" for="population-men">Men</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Women" id="population-women">
                        <label class="form-check-label" for="population-women">Women</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Children" id="population-children">
                        <label class="form-check-label" for="population-children">Children</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Adolescents" id="population-adolescents">
                        <label class="form-check-label" for="population-adolescents">Adolescents</label>
                    </div>
                </div>
                
                <!-- Resource Types Filter -->
                <div class="col-lg-3 col-md-3 col-sm-10 mb-4">
                    <h5>Resource Types</h5>
                    <div class="form-check">
                        <input class="form-check-input resource-type" type="checkbox" value="Recovery Support" id="type-recovery">
                        <label class="form-check-label" for="type-recovery">Recovery Support</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input resource-type" type="checkbox" value="Family Support" id="type-family">
                        <label class="form-check-label" for="type-family">Family Support</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input resource-type" type="checkbox" value="Housing" id="type-housing">
                        <label class="form-check-label" for="type-housing">Housing</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input resource-type" type="checkbox" value="Transportation" id="type-transportation">
                        <label class="form-check-label" for="type-transportation">Transportation</label>
                    </div>
                </div>
                
                <!-- Categories Filter -->
                <div class="col-lg-3 col-md-3 col-sm-10 mb-4">
                    <h5>Categories</h5>
                    <div id="categories-container">
                        <!-- Categories will be populated dynamically based on resource type selection -->
                        <p class="text-muted">Select a Resource Type to see categories</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Results Header -->
    <div class="results-header">
        <div id="counter" class="results-count">
            <h4>Results 1-25 of <span id="total-results">0</span></h4>
        </div>
        <div id="sort" class="sort-control">
            <h6 class="mb-0">Sort By:</h6>
            <select class="form-select" id="sort-select">
                <option value="relevance">Relevance</option>
                <option value="alphabetical">Alphabetical</option>
                <option value="distance">Distance</option>
            </select>
        </div>
    </div>
    
    <!-- Resources Container -->
    <div id="resources-container" class="row"></div>
    
    <!-- Load More Button -->
    <div id="load-more" class="text-center mt-4">
        <button id="load-more-btn" class="btn customButton--secondary">Load More</button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Constants
        const API_BASE_URL = 'https://app.nocodb.com/api/v2/tables/mu8v5qw718w8hkd/records';
        const API_TOKEN = 'IG35M16lOwlnPQWP3EcNcjI6nO7jXE4zBWvhdIOL';
        const PAGE_SIZE = 25;
        
        // State variables
        let allResources = [];
        let filteredResources = [];
        let displayedCount = 0;
        let activeFilters = {
            search: '',
            counties: [],
            populations: [],
            resourceTypes: [],
            categories: []
        };
        
        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const searchButton = document.querySelector('.searchButton');
        const chipsContainer = document.getElementById('chips-container');
        const resourcesContainer = document.getElementById('resources-container');
        const loadMoreBtn = document.getElementById('load-more-btn');
        const totalResultsSpan = document.getElementById('total-results');
        const sortSelect = document.getElementById('sort-select');
        const resourceTypeCheckboxes = document.querySelectorAll('.resource-type');
        const categoriesContainer = document.getElementById('categories-container');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            fetchResources();
            setupEventListeners();
            setupCategoryDependencies();
        });
        
        // Fetch resources from NocoDB
        async function fetchResources() {
            try {
                const response = await fetch(API_BASE_URL, {
                    headers: {
                        'xc-token': API_TOKEN
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch resources');
                }
                
                const data = await response.json();
                allResources = data.list || [];
                filteredResources = [...allResources];
                updateTotalResults();
                displayResources();
            } catch (error) {
                console.error('Error fetching resources:', error);
                resourcesContainer.innerHTML = '<div class="alert alert-danger">Failed to load resources. Please try again later.</div>';
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Search input events
            searchInput.addEventListener('input', () => {
                activeFilters.search = searchInput.value.toLowerCase();
                filterResources();
            });
            
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (searchInput.value.trim()) {
                        addSearchChip(searchInput.value);
                        searchInput.value = '';
                        activeFilters.search = '';
                        filterResources();
                    }
                }
            });
            
            searchButton.addEventListener('click', () => {
                if (searchInput.value.trim()) {
                    addSearchChip(searchInput.value);
                    searchInput.value = '';
                    activeFilters.search = '';
                    filterResources();
                }
            });
            
            // Ctrl+K shortcut for search
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            });
            
            // Filter checkbox events
            document.querySelectorAll('.form-check-input').forEach(checkbox => {
                checkbox.addEventListener('change', handleFilterChange);
            });
            
            // Sort select event
            sortSelect.addEventListener('change', () => {
                sortResources();
                displayedCount = 0;
                displayResources();
            });
            
            // Load more button
            loadMoreBtn.addEventListener('click', () => {
                displayedCount += PAGE_SIZE;
                displayResources();
            });
        }
        
        // Set up category dependencies based on resource types
        function setupCategoryDependencies() {
            const categoryMap = {
                'Recovery Support': [
                    'Single County Authority', 'Center of Excellence', 'Regional Recovery Hub', 
                    'Recovery Community Organization', 'Warm Handoff', 'Treatment with RSS'
                ],
                'Family Support': [
                    'Family Counseling', 'Family Peer Support', 'Family Assistance', 
                    'Program', 'Family Education Program', 'Family Resources'
                ],
                'Housing': [
                    'Recovery House', 'Halfway House', 'Housing Assistance'
                ],
                'Transportation': [
                    'Affordable Public Transportation', 'Carpool Service', 
                    'Medical Assistance Transportation', 'Recovery Transportation Services', 
                    'Vehicle Purchase Assistance'
                ]
            };
            
            resourceTypeCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateCategories();
                });
            });
            
            function updateCategories() {
                const selectedTypes = Array.from(resourceTypeCheckboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.value);
                
                let categoriesToShow = [];
                
                selectedTypes.forEach(type => {
                    if (categoryMap[type]) {
                        categoriesToShow = [...categoriesToShow, ...categoryMap[type]];
                    }
                });
                
                // Add Government and Other if any resource type is selected
                if (selectedTypes.length > 0) {
                    categoriesToShow.push('Government', 'Other');
                }
                
                // Remove duplicates
                categoriesToShow = [...new Set(categoriesToShow)];
                
                // Update categories UI
                if (categoriesToShow.length > 0) {
                    let html = '';
                    categoriesToShow.forEach(category => {
                        html += `
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="${category}" id="category-${category.replace(/\s+/g, '-').toLowerCase()}">
                                <label class="form-check-label" for="category-${category.replace(/\s+/g, '-').toLowerCase()}">${category}</label>
                            </div>
                        `;
                    });
                    
                    categoriesContainer.innerHTML = html;
                    
                    // Add event listeners to new checkboxes
                    document.querySelectorAll('#categories-container .form-check-input').forEach(cb => {
                        cb.addEventListener('change', handleFilterChange);
                    });
                } else {
                    categoriesContainer.innerHTML = '<p class="text-muted">Select a Resource Type to see categories</p>';
                }
            }
        }
        
        // Handle filter changes
        function handleFilterChange(e) {
            const filterType = e.target.closest('.col-lg-3').querySelector('h5').textContent;
            const value = e.target.value;
            const isChecked = e.target.checked;
            
            switch (filterType) {
                case 'Counties':
                    updateFilterArray('counties', value, isChecked);
                    break;
                case 'Populations':
                    updateFilterArray('populations', value, isChecked);
                    break;
                case 'Resource Types':
                    updateFilterArray('resourceTypes', value, isChecked);
                    break;
                case 'Categories':
                    updateFilterArray('categories', value, isChecked);
                    break;
            }
            
            filterResources();
        }
        
        // Update filter arrays
        function updateFilterArray(filterKey, value, isChecked) {
            if (isChecked) {
                if (!activeFilters[filterKey].includes(value)) {
                    activeFilters[filterKey].push(value);
                    addFilterChip(filterKey, value);
                }
            } else {
                activeFilters[filterKey] = activeFilters[filterKey].filter(item => item !== value);
                removeFilterChip(filterKey, value);
            }
        }
        
        // Add filter chip
        function addFilterChip(filterType, value) {
            const chipId = `${filterType}-${value.replace(/\s+/g, '-').toLowerCase()}`;
            
            if (!document.getElementById(chipId)) {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.id = chipId;
                chip.innerHTML = `
                    ${value}
                    <span class="close-chip" data-filter-type="${filterType}" data-value="${value}">
                        <i class="bi bi-x"></i>
                    </span>
                `;
                chipsContainer.appendChild(chip);
                
                // Add click event to remove chip
                chip.querySelector('.close-chip').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const filterType = e.target.closest('.close-chip').dataset.filterType;
                    const value = e.target.closest('.close-chip').dataset.value;
                    
                    // Uncheck the corresponding checkbox
                    const checkbox = document.querySelector(`input[type="checkbox"][value="${value}"]`);
                    if (checkbox) {
                        checkbox.checked = false;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
            }
        }
        
        // Add search chip
        function addSearchChip(searchTerm) {
            const chipId = `search-${searchTerm.replace(/\s+/g, '-').toLowerCase()}`;
            
            if (!document.getElementById(chipId)) {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.id = chipId;
                chip.innerHTML = `
                    Search: ${searchTerm}
                    <span class="close-chip" data-filter-type="search" data-value="${searchTerm}">
                        <i class="bi bi-x"></i>
                    </span>
                `;
                chipsContainer.appendChild(chip);
                
                // Add click event to remove chip
                chip.querySelector('.close-chip').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const searchTerm = e.target.closest('.close-chip').dataset.value;
                    
                    // Remove the chip
                    chip.remove();
                    
                    // If this was the last search chip, clear the search filter
                    const searchChips = document.querySelectorAll('.chip[data-filter-type="search"]');
                    if (searchChips.length === 0) {
                        activeFilters.search = '';
                        filterResources();
                    }
                });
            }
        }
        
        // Remove filter chip
        function removeFilterChip(filterType, value) {
            const chipId = `${filterType}-${value.replace(/\s+/g, '-').toLowerCase()}`;
            const chip = document.getElementById(chipId);
            if (chip) {
                chip.remove();
            }
        }
        
        // Filter resources based on active filters
        function filterResources() {
            filteredResources = allResources.filter(resource => {
                // Search filter
                if (activeFilters.search) {
                    const searchFields = [
                        resource.LocationName?.toLowerCase(),
                        resource.Organization?.toLowerCase(),
                        resource.Address?.toLowerCase(),
                        resource.City?.toLowerCase()
                    ].join(' ');
                    
                    if (!searchFields.includes(activeFilters.search)) {
                        return false;
                    }
                }
                
                // County filter
                if (activeFilters.counties.length > 0) {
                    if (!activeFilters.counties.includes(resource.County)) {
                        return false;
                    }
                }
                
                // Population filter
                if (activeFilters.populations.length > 0) {
                    const resourcePopulations = resource.Populations?.split(',').map(p => p.trim()) || [];
                    const hasMatchingPopulation = activeFilters.populations.some(pop => 
                        resourcePopulations.includes(pop)
                    );
                    
                    if (!hasMatchingPopulation) {
                        return false;
                    }
                }
                
                // Resource Type filter
                if (activeFilters.resourceTypes.length > 0) {
                    if (!activeFilters.resourceTypes.includes(resource.ResourceType)) {
                        return false;
                    }
                }
                
                // Category filter
                if (activeFilters.categories.length > 0) {
                    const resourceCategories = resource.Category?.split(',').map(c => c.trim()) || [];
                    const hasMatchingCategory = activeFilters.categories.some(cat => 
                        resourceCategories.includes(cat)
                    );
                    
                    if (!hasMatchingCategory) {
                        return false;
                    }
                }
                
                return true;
            });
            
            sortResources();
            updateTotalResults();
            displayedCount = 0;
            displayResources();
        }
        
        // Sort resources
        function sortResources() {
            const sortBy = sortSelect.value;
            
            switch (sortBy) {
                case 'alphabetical':
                    filteredResources.sort((a, b) => 
                        (a.LocationName || '').localeCompare(b.LocationName || '')
                    );
                    break;
                case 'distance':
                    // For now, just sort by city as a placeholder
                    // In a real app, you would use geolocation and calculate distances
                    filteredResources.sort((a, b) => 
                        (a.City || '').localeCompare(b.City || '')
                    );
                    break;
                case 'relevance':
                default:
                    // Default sorting - could be by ID or another field
                    filteredResources.sort((a, b) => (a.Id || 0) - (b.Id || 0));
                    break;
            }
        }
        
        // Update total results count
        function updateTotalResults() {
            const total = filteredResources.length;
            const showing = Math.min(displayedCount + PAGE_SIZE, total);
            totalResultsSpan.textContent = total;
            
            // Update the counter text
            document.querySelector('#counter h4').textContent = 
                `Results 1-${showing} of ${total}`;
        }
        
        // Display resources
        function displayResources() {
            const resourcesToShow = filteredResources.slice(0, displayedCount + PAGE_SIZE);
            
            if (resourcesToShow.length === 0) {
                resourcesContainer.innerHTML = '<div class="col-12"><p class="text-center">No resources found matching your criteria.</p></div>';
                loadMoreBtn.style.display = 'none';
                return;
            }
            
            let html = '';
            
            resourcesToShow.forEach(resource => {
                const populations = resource.Populations?.split(',').map(p => p.trim()).filter(p => p) || [];
                const categories = resource.Category?.split(',').map(c => c.trim()).filter(c => c) || [];
                
                html += `
                    <div class="col-12 mb-4">
                        <div class="resourceCard shadow-lg text-bg-white br-5-5-5-5">
                            <div class="row no-gutters p-0">
                                <div class="card-sidenav col-2 d-flex flex-column justify-content-between align-items-center p-0">
                                    ${resource.Website ? `<a href="${resource.Website}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white" target="_blank"><i class="bi bi-globe"></i></a>` : ''}
                                    ${resource.PhoneUrl ? `<a href="${resource.PhoneUrl}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white"><i class="bi bi-telephone-fill"></i></a>` : ''}
                                    ${resource.GoogleMapsUrl ? `<a href="${resource.GoogleMapsUrl}" class="d-flex align-items-center justify-content-center flex-grow-1 w-100 text-white" target="_blank"><i class="bi bi-geo-alt-fill"></i></a>` : ''}
                                </div>
                                <div class="card-body col-10 p-4">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <h3 class="text-secondary" style="font-weight:400;margin-bottom:0;line-height:1.2em;font-size:36px">${resource.LocationName || ''}</h3>
                                            <h5 style="font-weight:100;margin-top:0;font-size:18px">${resource.Organization || ''}</h5>
                                            
                                            ${resource.ResourceType ? `<span class="badge text-black bg-pink py-2 my-1 badge-filter" data-filter-type="resourceTypes" data-value="${resource.ResourceType}">${resource.ResourceType}</span>` : ''}
                                            
                                            ${categories.map(category => 
                                                `<span class="badge text-black bg-pink py-2 my-1 badge-filter" data-filter-type="categories" data-value="${category}">${category}</span>`
                                            ).join('')}
                                            
                                            ${resource.Phone ? `<h6 class="mt-2">Phone: ${resource.Phone}</h6>` : ''}
                                            
                                            ${resource.Address || resource.City || resource.State || resource.ZipCode ? `
                                                <p class="mb-2">
                                                    ${resource.Address || ''}${resource.Address ? '<br />' : ''}
                                                    ${resource.City || ''}${resource.City && (resource.State || resource.ZipCode) ? ', ' : ''}
                                                    ${resource.State || ''}${resource.State && resource.ZipCode ? ', ' : ''}
                                                    ${resource.ZipCode || ''}
                                                </p>
                                            ` : ''}
                                            
                                            ${populations.length > 0 ? `
                                                <h6 class="mb-1">Populations Served:</h6>
                                                ${populations.map(pop => 
                                                    `<span class="badge text-black bg-pink py-2 my-1 badge-filter" data-filter-type="populations" data-value="${pop}">${pop}</span>`
                                                ).join('')}
                                            ` : ''}
                                            
                                            ${resource.County ? `
                                                <h6 class="mb-1">County:</h6>
                                                <span class="badge text-black bg-pink py-2 my-1 badge-filter" data-filter-type="counties" data-value="${resource.County}">${resource.County}</span>
                                            ` : ''}
                                        </div>
                                        <div class="col-md-4 d-flex justify-content-end align-items-end">
                                            ${resource.Image ? `<img class="cardImage" src="${resource.Image}" alt="${resource.LocationName || 'Resource'} Logo">` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            resourcesContainer.innerHTML = html;
            
            // Add click events to filter badges
            document.querySelectorAll('.badge-filter').forEach(badge => {
                badge.addEventListener('click', (e) => {
                    const filterType = e.target.dataset.filterType;
                    const value = e.target.dataset.value;
                    
                    // Find and check the corresponding checkbox
                    const checkbox = document.querySelector(`input[type="checkbox"][value="${value}"]`);
                    if (checkbox) {
                        if (!checkbox.checked) {
                            checkbox.checked = true;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    }
                });
            });
            
            // Show/hide load more button
            loadMoreBtn.style.display = 
                (displayedCount + PAGE_SIZE) < filteredResources.length ? 'inline-block' : 'none';
        }
    </script>
</body>
</html>